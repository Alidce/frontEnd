{"version":3,"sources":["../treeSelect.js"],"names":[],"mappings":"AAAA,IAAI,MAAM,CAAV;AACA,MAAM,UAAN,CAAiB;AACb,WAAO,UAAP,GAAoB;AAChB,eAAO,KAAP;AACH;AACD,gBAAY,OAAZ,EAAqB;AACjB,YAAI,OAAO,IAAX;;AAEA,YAAI,iBAAiB;AACjB,sBAAU,IADO;AAEjB,yBAAa,IAFI;AAGjB,yBAAa,EAHI;AAIjB,kCAAsB;AAJL,SAArB;AAMA,aAAK,OAAL,GAAe,UAAU,EAAE,MAAF,CAAS,cAAT,EAAyB,OAAzB,CAAzB;AACA,YAAI,MAAM,WAAW,UAAX,EAAV;AACA,YAAI,MAAO;;wEAEqD,GAAI;SAFpE;AAIA,YAAI,MAAM,EAAE,QAAQ,OAAV,CAAV;AACA,YAAI,IAAJ,CAAS,GAAT;AACA,YAAI,QAAQ,IAAI,IAAJ,CAAS,mBAAT,CAAZ;AACA,YAAI,QAAQ,IAAI,IAAJ,CAAS,mBAAT,CAAZ;AACA,cAAM,KAAN,CAAY,UAAU,KAAV,EAAiB;AACzB,gBAAI,SAAS,MAAM,eAAnB,EAAoC,MAAM,eAAN,GAApC,KACK,OAAO,KAAP,CAAa,YAAb,GAA4B,IAA5B;AACL,mBAAO,KAAP;AACH,SAJD;AAKA,aAAK,OAAL,GAAe,GAAf;AACA,aAAK,KAAL,GAAa,KAAb;AACA,aAAK,KAAL,GAAa,KAAb;AACA,YAAI,GAAJ,CAAQ;AACJ,wBAAY;AADR,SAAR;AAGA,YAAI,CAAC,KAAK,OAAL,CAAa,WAAlB,EAA+B;AAC3B,kBAAM,GAAN,CAAU,SAAV,EAAqB,MAArB;AACA,iBAAK,KAAL,CAAW,GAAX,CAAe,UAAf,EAA2B,UAA3B;AACH;AACD,cAAM,EAAN,CAAS,SAAT,EAAoB,YAAY;;AAE5B;AACA,mBAAO,KAAP;AACH,SAJD;;AAMA,cAAM,KAAN,CAAY,UAAU,KAAV,EAAiB;AACzB,gBAAI,CAAC,KAAK,MAAL,EAAL,EAAoB;AAChB,qBAAK,IAAL,CAAU,KAAV;AACH,aAFD,MAEO;AACH,qBAAK,KAAL;AACH;AAEJ,SAPD;AAQA,YAAI,QAAQ,GAAZ,EAAiB;AACb,cAAE,IAAF,CAAO;AACH,sBAAM,QAAQ,IADX;AAEH,qBAAK,QAAQ,GAFV;AAGH,0BAAU,MAHP;AAIH,sBAAM,QAAQ,KAJX;AAKH,yBAAS,UAAU,IAAV,EAAgB;AACrB,yBAAK,MAAL,CAAY,IAAZ;AACH,iBAPE;AAQH,uBAAO,UAAU,IAAV,EAAgB,CAEtB;AAVE,aAAP;AAYH,SAbD,MAaO,IAAI,QAAQ,IAAZ,EAAkB;AACrB,iBAAK,MAAL,CAAY,QAAQ,IAApB;AACH;AACJ;;AAED,aAAS;AACL,YAAI,QAAQ,KAAK,KAAjB;AACA,eAAO,EAAE,MAAM,GAAN,CAAU,SAAV,KAAwB,MAAxB,IAAkC,MAAM,MAAN,MAAkB,CAApD,IAAyD,MAAM,GAAN,CAAU,SAAV,KAAwB,CAAnF,CAAP;AACH;AACD,WAAO,IAAP,EAAa;AACT,YAAI,OAAO,IAAX;AACA,YAAI,QAAQ,KAAK,KAAjB;AACA,YAAI,UAAU;AACV,mBAAO;AACH,wBAAQ;AADL,aADG;AAIV,kBAAM;AACF,4BAAY;AACR,4BAAQ;AADA;AADV,aAJI;AASV,kBAAM;AACF,+BAAe;AADb,aATI;;AAaV,sBAAU;AACN,yBAAS,UAAU,KAAV,EAAiB,MAAjB,EAAyB,QAAzB,EAAmC,CAE3C,CAHK;AAIN,yBAAS,SAAS,OAAT,CAAiB,CAAjB,EAAoB,MAApB,EAA4B,QAA5B,EAAsC;AAC3C,wBAAI,QAAQ,EAAE,EAAF,CAAK,KAAL,CAAW,WAAX,CAAuB,MAAvB,CAAZ;AAAA,wBACI,QAAQ,MAAM,eAAN,CAAsB,IAAtB,CADZ;AAAA,wBAEI,IAAI,EAFR;AAAA,wBAGI,IAAI,EAHR;AAIA,yBAAK,IAAI,IAAI,CAAR,EAAW,IAAI,MAAM,MAA1B,EAAkC,IAAI,CAAtC,EAAyC,GAAzC,EAA8C;AAC1C,4BAAI,CAAC,MAAM,CAAN,EAAS,QAAd,EAAwB;AACpB,iCAAK,MAAM,CAAN,EAAS,IAAT,GAAgB,GAArB;AACA,iCAAK,MAAM,CAAN,EAAS,KAAK,OAAL,CAAa,QAAtB,IAAkC,GAAvC;AACH;AACJ;AACD,wBAAI,EAAE,MAAF,GAAW,CAAf,EAAkB,IAAI,EAAE,SAAF,CAAY,CAAZ,EAAe,EAAE,MAAF,GAAW,CAA1B,CAAJ;AAClB,wBAAI,EAAE,MAAF,GAAW,CAAf,EAAkB,IAAI,EAAE,SAAF,CAAY,CAAZ,EAAe,EAAE,MAAF,GAAW,CAA1B,CAAJ;AAClB,yBAAK,KAAL,CAAW,GAAX,CAAe,CAAf;AACA,yBAAK,KAAL,GAAa,CAAb;AACA,yBAAK,IAAL,GAAY,CAAZ;AACH;AApBK;AAbA,SAAd;AAoCA;AACA,YAAI,KAAK,OAAL,CAAa,oBAAjB,EAAuC;AACnC,iBAAK,OAAL,CAAa,UAAU,SAAV,EAAqB;AAC9B,0BAAU,WAAV,GAAwB,IAAxB;AACA,oBAAI,UAAU,QAAV,IAAsB,UAAU,QAAV,CAAmB,MAAnB,GAA4B,CAAtD,EAAyD;AACrD,8BAAU,QAAV,CAAmB,OAAnB,CAA2B,UAAU,UAAV,EAAsB;AAC7C,mCAAW,WAAX,GAAyB,IAAzB;AACH,qBAFD;AAGH;AACJ,aAPD;AAQH;AACD,aAAK,KAAL,GAAa,EAAE,EAAF,CAAK,KAAL,CAAW,IAAX,CAAgB,KAAhB,EAAuB,OAAvB,EAAgC,IAAhC,CAAb;AACA;AACA,YAAG,KAAK,OAAL,CAAa,WAAhB,EAA4B;AACzB,iBAAK,iBAAL,CAAuB,KAAK,OAAL,CAAa,WAApC;AACF;AACD,YAAI,CAAC,KAAK,OAAL,CAAa,WAAlB,EAA+B;AAC3B,iBAAK,IAAL;AACH;AACJ;AACD,SAAK,KAAL,EAAY;AACR,YAAI,SAAS,MAAM,eAAnB,EAAoC,MAAM,eAAN,GAApC,KACK,OAAO,KAAP,CAAa,YAAb,GAA4B,IAA5B;AACL,YAAI,OAAO,IAAX;AACA,YAAI,QAAQ,KAAK,KAAjB;AACA,cAAM,GAAN,CAAU;AACN,oBAAQ,MADF;AAEN,qBAAS;AAFH,SAAV;AAIA,cAAM,IAAN;AACA,YAAI,KAAK,OAAL,CAAa,WAAjB,EAA8B;AAC1B,cAAE,QAAF,EAAY,GAAZ,CAAgB,OAAhB,EAAyB,UAAU,KAAV,EAAiB;AACtC,qBAAK,KAAL;AACH,aAFD;AAGH;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH;AACD,YAAQ;;AAEJ,YAAI,OAAO,IAAX;AACA,aAAK,KAAL,CAAW,IAAX;AACA;AACH;AACD;;;;AAIA,sBAAkB,GAAlB,EAAuB;AACnB,YAAI,UAAU,IAAI,KAAJ,CAAU,GAAV,CAAd;AACA,YAAI,OAAO,IAAX;AACA,YAAI,OAAO,KAAK,KAAhB;AACA,aAAK,aAAL,CAAmB,KAAnB;AACA,gBAAQ,OAAR,CAAgB,UAAU,EAAV,EAAc;AAC1B,iBAAK,SAAL,CAAe,KAAK,cAAL,CAAoB,IAApB,EAA0B,EAA1B,EAA8B,IAA9B,CAAf,EAAoD,IAApD,EAA0D,IAA1D;AACH,SAFD;AAGH;AAhLY","file":"treeSelect.js","sourcesContent":["var uid = 0;\r\nclass TreeSelect {\r\n    static getUniquId() {\r\n        return uid++;\r\n    }\r\n    constructor(options) {\r\n        var self = this;\r\n\r\n        var defaultOptions = {\r\n            valueKey: 'id',\r\n            isShowInput: true,\r\n            selectedIds: '',\r\n            onlyChooseThreeLevel: false\r\n        }\r\n        self.options = options = $.extend(defaultOptions, options);\r\n        var uid = TreeSelect.getUniquId();\r\n        var tpl = `\r\n            <input type=\"text\" class=\"form-control treeSelect-input \"/>\r\n             <div class=\"ztree treeSelect-panel\" id=\"treeSelect_panel_${uid}\"></div>\r\n        `;\r\n        var ele = $(options.element);\r\n        ele.html(tpl);\r\n        var input = ele.find('.treeSelect-input');\r\n        var panel = ele.find('.treeSelect-panel');\r\n        panel.click(function (event) {\r\n            if (event && event.stopPropagation) event.stopPropagation();\r\n            else window.event.cancelBubble = true;\r\n            return false;\r\n        })\r\n        self.element = ele;\r\n        self.input = input;\r\n        self.panel = panel;\r\n        ele.css({\r\n            'position': 'relative'\r\n        });\r\n        if (!self.options.isShowInput) {\r\n            input.css('display', 'none');\r\n            self.panel.css('position', 'relative');\r\n        }\r\n        input.on('keydown', function () {\r\n\r\n            //input.val(self.text);\r\n            return false;\r\n        });\r\n\r\n        input.click(function (event) {\r\n            if (!self.isOpen()) {\r\n                self.open(event);\r\n            } else {\r\n                self.close();\r\n            }\r\n\r\n        });\r\n        if (options.url) {\r\n            $.ajax({\r\n                type: options.type,\r\n                url: options.url,\r\n                dataType: 'json',\r\n                data: options.param,\r\n                success: function (data) {\r\n                    self.render(data);\r\n                },\r\n                error: function (data) {\r\n\r\n                }\r\n            })\r\n        } else if (options.data) {\r\n            self.render(options.data);\r\n        }\r\n    }\r\n\r\n    isOpen() {\r\n        var panel = this.panel;\r\n        return !(panel.css('display') == 'none' || panel.height() == 0 || panel.css('opacity') == 0)\r\n    }\r\n    render(data) {\r\n        var self = this;\r\n        var panel = self.panel;\r\n        var setting = {\r\n            check: {\r\n                enable: true\r\n            },\r\n            data: {\r\n                simpleData: {\r\n                    enable: true\r\n                }\r\n            },\r\n            view: {\r\n                selectedMulti: false\r\n            },\r\n\r\n            callback: {\r\n                onClick: function (event, treeId, treeNode) {\r\n\r\n                },\r\n                onCheck: function onCheck(e, treeId, treeNode) {\r\n                    var zTree = $.fn.zTree.getZTreeObj(treeId),\r\n                        nodes = zTree.getCheckedNodes(true),\r\n                        v = \"\",\r\n                        k = \"\";\r\n                    for (var i = 0, l = nodes.length; i < l; i++) {\r\n                        if (!nodes[i].isParent) {\r\n                            v += nodes[i].name + \",\";\r\n                            k += nodes[i][self.options.valueKey] + \",\";\r\n                        }\r\n                    }\r\n                    if (v.length > 0) v = v.substring(0, v.length - 1);\r\n                    if (k.length > 0) k = k.substring(0, k.length - 1);\r\n                    self.input.val(v);\r\n                    self.value = k;\r\n                    self.text = v;\r\n                }\r\n            }\r\n        };\r\n        //只能选择第三级节点\r\n        if (self.options.onlyChooseThreeLevel) {\r\n            data.forEach(function (itemFrist) {\r\n                itemFrist.chkDisabled = true;\r\n                if (itemFrist.children && itemFrist.children.length > 0) {\r\n                    itemFrist.children.forEach(function (itemSecond) {\r\n                        itemSecond.chkDisabled = true;\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        self.ztree = $.fn.zTree.init(panel, setting, data);\r\n        //设置已经选择的节点\r\n        if(self.options.selectedIds){\r\n           self.showSelectedNodes(self.options.selectedIds);\r\n        }\r\n        if (!self.options.isShowInput) {\r\n            self.open();\r\n        }\r\n    }\r\n    open(event) {\r\n        if (event && event.stopPropagation) event.stopPropagation();\r\n        else window.event.cancelBubble = true;\r\n        var self = this;\r\n        var panel = self.panel;\r\n        panel.css({\r\n            height: 'auto',\r\n            opacity: 1\r\n        });\r\n        panel.show();\r\n        if (self.options.isShowInput) {\r\n            $(document).one(\"click\", function (event) {\r\n                self.close();\r\n            });\r\n        }\r\n        // self.mask = $('<div class=\"treeSelect-mask\"></div>');\r\n        // if (self.options.isShowInput) {\r\n        //     $('body').append(self.mask);\r\n        // }\r\n        // self.mask.click(function () {\r\n        //     if (self.options.isShowInput) {\r\n        //         self.close();\r\n        //     }\r\n        // })\r\n    }\r\n    close() {\r\n\r\n        var self = this;\r\n        self.panel.hide();\r\n        // self.mask.remove();\r\n    }\r\n    /**\r\n     * 设置选过的节点\r\n     * @param {*} ids \r\n     */\r\n    showSelectedNodes(ids) {\r\n        var idArray = ids.split(',');\r\n        var self = this;\r\n        var tree = self.ztree;\r\n        tree.checkAllNodes(false);\r\n        idArray.forEach(function (id) {\r\n            tree.checkNode(tree.getNodeByParam(\"id\", id, null), true, true);\r\n        });\r\n    }\r\n}"]}